var PolygonTile=function(a,b,c){var a=a||50,b=b||"blue",c=c||4,d=3==c||4==c||6==c,e=0,f={},g=[],h=function(a){return a=[Math.round(a[0]),Math.round(a[1])],x=a[0],y=a[1],f[a]||f[[x+1,y]]||f[[x-1,y]]||f[[x,y+1]]||f[[x,y-1]]||f[[x+1,y+1]]||f[[x-1,y-1]]||f[[x+1,y-1]]||f[[x-1,y+1]]?!0:!1},i=function(b){for(var d=2*a*Math.cos(Math.PI/c),f=0;f<g.length;f++){var h=Math.sqrt(Math.pow(b[0]-g[f].center[0],2)+Math.pow(b[1]-g[f].center[1],2));if(Math.round(h)<Math.round(d))return!0}return!1},j=function(j,k,l){l=l||0,k=k+e||0;for(var m=[],n=[],p=(2*Math.PI/c,0);c>p;p++){var q=j[0]+a*Math.sin(2*Math.PI*p/c+k),r=j[1]-a*Math.cos(2*Math.PI*p/c+k);n.push([q,r]),m.push(q+","+r)}(d&&!h(j)||!d&&!i(j))&&(d3.select("svg").append("polygon").classed("new-poly poly-"+l,!0).attr("fill",b).attr("stroke",b).attr("stroke-width",2).attr("points",m).attr("style","fill-opacity:"+(Math.random()+.5)/2).datum({center:j,offset:k,iteration:l}),f[[Math.round(j[0]),Math.round(j[1])]]=!0,g.push({center:j,points:n}))},k=function(b,d,f){d=d+e||0;var g=Math.PI/c,h=a*Math.cos(g);d+=g;for(var i=0;c>i;i++){var k=b[0]+2*h*Math.sin(2*Math.PI*i/c+d),l=b[1]-2*h*Math.cos(2*Math.PI*i/c+d);c%2==0?j([k,l],0,f):j([k,l],2*Math.PI*i/c+d,f)}},l=function(b,d,f){d=d+e||0;var g=Math.PI/c,h=a*Math.cos(g);d+=g;var i=1,k=0;9==c&&(k=1,i=3);for(var l=k;c>l;l+=i){var m=b[0]+2*h*Math.sin(2*Math.PI*l/c+d),n=b[1]-2*h*Math.cos(2*Math.PI*l/c+d);c%2==0?j([m,n],0,f):j([m,n],2*Math.PI*l/c+d,f)}};this.tilt=function(){return e+=2*Math.PI/(2*c),this},this.animateRemoval=function(a,b){a=a||150;var c=0,d=setInterval(function(){d3.selectAll(".poly-"+c).each(function(){var a=d3.select(this);a.style({display:"none"})}),c++,b&&c==b&&clearInterval(d)},a)},this.animate=function(b){b=b||150;var c=0,e=setInterval(function(){startX=(Math.max(document.documentElement.clientWidth,window.innerWidth||0)-a)/2,startY=(Math.max(document.documentElement.clientHeight,window.innerHeight||0)-a)/2,0==c?(d3.select("body").append("svg").attr("width","100%").attr("height","100%"),j([startX,startY],0)):d3.selectAll(".new-poly").each(function(){var a=d3.select(this),b=a.datum().center,e=a.datum().offset;d?k(b,e,c):l(b,e,c),a.classed("new-poly",!1)}),c++,25==c&&clearInterval(e)}.bind(this),b)},this.animateExisting=function(a,b){a=a||150;var c=0,d=setInterval(function(){d3.selectAll(".poly-"+c).each(function(){var a=d3.select(this);a.style({display:"block"})}),c++,b&&c==b&&clearInterval(d)},a)},this.animateThenRemove=function(a,b,c,d){a=a||3e3,b=b||100,c=c||150,this.animate(b),setTimeout(function(){this.animateRemoval(c,d)}.bind(this),a)},this.addRemoveCycle=function(a){a=a||2e3,this.animate(),counter=1,setInterval(function(){counter%2==0?this.animateRemoval():this.animateExisting(),counter++}.bind(this),a)},this.render=function(){for(var b=0;;)if(startX=(Math.max(document.documentElement.clientWidth,window.innerWidth||0)-a)/2,startY=(Math.max(document.documentElement.clientHeight,window.innerHeight||0)-a)/2,0==b?(d3.select("body").append("svg").attr("width","100%").attr("height","100%"),j([startX,startY],0)):d3.selectAll(".new-poly").each(function(){var a=d3.select(this),c=a.datum().center,e=a.datum().offset;d?k(c,e,b):l(c,e,b),a.classed("new-poly",!1)}),b++,25==b)break}};
